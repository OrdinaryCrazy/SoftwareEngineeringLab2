\chapter{\color{red} 出错处理设计}
\section{数据库出错处理}
多重备份时，应采取何种策略，先利用哪一份备份；系统是否暂停服务等。

\begin{itemize}
    \item 当用户信息数据库出错时，立即启动同步备份的数据库，并将其复制到本地。若依然无法恢复，暂停整个用户系统的服务，向客户端的相关操作返回报错信息。同时派专员进行后台修复和安全性检查。向错误信息处理模块发送错误信息。
    \item  当聊天信息数据库出错时，将数据库回退到上一时间，并根据日志重新向用户发送聊天信息。若无法回退或日志丢失，则调用备份数据库，并向用户返回消息发送失败的信息。对于音视频信息，尝试重新连接。同时派专员进行后台修复和网络检查。向错误信息处理模块发送错误信息。
    \item 当文件或云文件数据库出错时，立即启动同步备份的数据库，并将其复制到本地。若依然无法恢复，向用户返回文件丢失的信息。同时派专员后台排查恶意攻击和隐私泄露的情况。向错误信息处理模块发送错误信息。
    \item 当协作文档数据库出错时，将数据库回退到上一时间，并将缓冲池中的数据写回。若无法回退，则调用其他备份数据库。同时派专员进行后台修复和存储检查。向错误信息处理模块发送错误信息。

\end{itemize}


\section{\color{red} 某模块失效处理}
\subsection{用户信息管理模块失效}
若用户信息管理模块失效，则所有操作均无法正常进行。因此，需要对该服务进行多处热备份。失效时向错误信息管理模块发送错误信息，并立即启用备份服务。后台派专员进行错误检查和恢复。若依然无法继续服务，则整个系统暂停服务。
\subsection{通讯管理模块失效}
若通讯管理模块失效，则聊天，邮件，查询聊天记录等功能无法进行。首先检查是否为网络问题，若是，则切换网络并重启。否则，启用备份服务，发送错误信息，等待后台维护人员处理。若依然失效，则向用户聊天窗口，邮件窗口报错，尽快恢复服务。
\subsection{文件管理模块失效}
若文件管理模块失效，则文件上传，下载，收发，日历功能和部分群组功能会受到影响。失效时首先缓存正在处理的文件，向错误信息管理模块发送错误信息，然后启用备份服务，从而尽快恢复服务。
\subsection{云文件管理模块失效}
若云文件管理模块失效，则部分云文件上传，下载，收发功能会受到影响。失效时依然维持其他服务状态，检查具体失效的功能，暂时禁用失效的部分功能。向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{日历管理模块失效}
若日历管理模块失效，则日历的修改，团队任务布置等功能受到影响。失效时暂时禁用日历功能，维持其它功能运行。向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{团队管理模块失效}
若团队管理模块失效，则团队信息管理，权限管理，协作文档等功能受到影响。失效时维持最小服务状态（即时通讯），向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{在线协作平台模块失效}
若在线协作平台模块失效，则在线协作功能受到影响。失效时，首先缓存正在处理的文档，维持其它功能的运行，禁用团队布置文档和用户编辑文档。向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{错误信息管理模块失效}
若错误信息管理模块失效，则各个功能部件传输的错误信息可能无法收到，运维人员发布的错误解决方案可能也无法部署。此时，维持系统正在运行的服务，后台派专员进行错误检查和恢复。
{\color{red}
\subsection{\color{red} 调研管理模块失效}
若调研管理模块失效，则调研，投票功能无法运行，正在执行中的调研可能受到影响。失效时，首先关闭正在进行的调研，向用户发送服务暂停的消息，维持其他功能运行。然后启用备份服务，启动完毕后，若服务恢复，则向用户发送服务恢复消息，并检查数据库的一致性。若依然未能恢复，向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{\color{red} 审批管理模块失效}
若审批管理模块失效，则审批功能无法进行。失效时，暂停审批服务，维持其他服务的正常运行。若此时有用户查询或申请审批，则向其返回错误信息。启用备份服务，启动完毕后，若服务恢复，检查数据库的一致性，并检查审批材料的机密性，完整性。若存在安全攻击痕迹，则派专员调查。若依然未能恢复，向错误信息管理模块发送错误信息，后台派专员进行错误检查和恢复。
\subsection{\color{red} 第三方账号管理模块失效}
若第三方账号管理模块失效，则可能无法连接第三方服务，登陆第三方账号，获取第三方平台的消息。该失效可能来源于即时通讯系统内部，也可能来源于第三方平台故障或API故障。失效时，暂停第三方平台连接服务，向用户发送对应的错误信息，并维持其他服务的正常运行。排查故障原因，若是己方故障，则启用备份系统，恢复后向用户发送恢复服务信息，并后台派专员进行错误检查和恢复；若是对方（第三方平台）故障，则向对方发送错误信息，并等待对方服务恢复。

}
