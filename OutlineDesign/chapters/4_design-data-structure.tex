\chapter{数据结构设计}
%=================================================================================
    \section{逻辑结构设计}
    %-----------------------------------------------------------------------------

        %================================ GUIDE ==================================
        % 讲述本系统内需要什么数据结构。这指的是程序运行过程中维护的数据结构。
        % 只是举个例子，此处应和3.3一致。
        %================================ GUIDE ==================================
    %-----------------------------------------------------------------------------
        \subsection{客户端数据结构}
        
    %-----------------------------------------------------------------------------

        
    %-----------------------------------------------------------------------------
\subsubsection{数据结构1：User\_client}
该数据结构定义了用户的基本属性。
\begin{lstlisting}[language=Java, caption=User定义]
public class User{
    private String ID;//用户ID，唯一
    private String name;//昵称，不唯一
    private String sex="Male";//性别，默认男性
    private Date birthday;//用户的出生日期，可以为空
    private Time createTime;//账户创建时间
    private String address;//用户地址，可以为空
    private String email;//用户绑定的邮箱，可以为空
    public User(String ID){

    }
    public User(String ID,String name,String sex,
        Date birthday,String address,String email){

    }
    public String getID(){

    }
    public String getName(){

    }
    public void setName(String name){

    }
    public String getSex(){

    }
    public void setSex(String sex){

    }
    public Date getBirthday(){

    }
    public void setBirthday(Date birthday){

    }
    public int getAge(){

    }
    public Time getCreateTime(){

    }
    public void setCreateTime(Time createTime){

    }
    public String getAddress(){

    }
    public void setAddress(String address){

    }
    public String getEmail(){

    }
    public void setEmail(String email){

    }
}
\end{lstlisting}

\subsubsection{数据结构2：Message\_client}
该数据结构定义了一对一聊天时发送的信息，所有属性都是不可修改的。此外，在发送文件时，该数据结构也会被使用，用于声明文件的一些基本信息（使用message域）。
\begin{lstlisting}[language=Java, caption=Message定义]
public class Message{
    private User sender,receiver;//该信息的发送方和接收方
    private String message;//信息内容
    private Time sendtime;//发送时间
    public Message(User sender,User receiver,String message,
        Time sendtime){

    }
    public User getSender(){

    }
    public User getReceiver(){

    }
    public String getMessage(){
        
    }
    public Time getSendtime(){

    }
}
\end{lstlisting}
    
\subsubsection{数据结构3：GroupMessage\_client}
该数据结构定义了群聊时发送的信息，继承自Message类。同样，所有属性都是不可修改的。
\begin{lstlisting}[language=Java, caption=GroupMessage定义]
public class GroupMessage extends Message{
    private Group group;//所属的群聊
    public GroupMessage(Group group,User sender,
        User receiver, String message,Time sendtime){

    }
    public Group getGroup(){

    }
}
\end{lstlisting}

\subsubsection{数据结构4：Group\_client}
该数据结构定义了群聊的基本属性。
\begin{lstlisting}[language=Java, caption=Group定义]
public class Group{
    private String ID;//群ID，唯一
    private String name;//群名称，不唯一
    private User master;//群主
    private User[] managerList;//管理员列表
    private User[] memberList;//群成员列表
    private Scene scene; //场景
    public Group(String ID,User master){

    }
    public String getID(){

    }
    public String getName(){

    }
    public void setName(String name){

    }
    public User getMaster(){

    }
    public User[] getManagerList(){

    }
    public User[] getMemberList(){

    }
    public void appointManager(User user){
    //任命管理员
    }
    public void dismissManager(User user){
    //解除管理员职务
    }
    public void addMember(User user){
    //增加群成员
    }
    public void deleteMember(User user){
    //删除群成员
    }
    public Scene getScene(){

    }
    public void setScene(Scene scene){
        
    }
}
\end{lstlisting}

\subsubsection{数据结构5：Friend\_client}
该数据结构定义了通讯录中好友的基本属性。通讯录可以对好友分组管理，这是通过tag实现的，具有相同tag的用户被认为是一个组。
\begin{lstlisting}[language=Java, caption=Friend定义]
public class Friend{
    private User user;//用户
    private String tag;//分组标记，内容是组名
    private String remark;//备注名
    public Friend(User user,String tag,String remark){

    }
    public User getUser(){

    }
    public String getTag(){

    }
    public void setTag(String tag){

    }
    public String getRemark(){

    }
    public void setRemark(String remark){

    }
}
\end{lstlisting}

\subsubsection{数据结构6：AddressBook\_client}
该数据结构定义了通讯录，包括好友列表，群聊列表和黑名单。
\begin{lstlisting}[language=Java, caption=AddressBook定义]
public class AddressBook{
    private Friend[] friendList;//好友列表
    private User[] blackList;//黑名单
    private Group[] groupList;//群聊列表
    public AddressBook(){

    }
    public Friend[] getFriendList(){

    }
    public User[] getBlackList(){

    }
    public Group[] getGroupList(){

    }
    public void addFriend(User user){

    }
    public void addFriend(Friend friend){

    }
    public void deleteFriend(Friend friend){
        
    }
    public void addBlack(User user){

    }
    public void deleteBlack(User user){

    }
    public void addGroup(Group group){

    }
    public void deleteGroup(Group group){

    }
    public Friend[] findFriendByTag(String tag){
        //查找某一组的所有好友
    }
}
\end{lstlisting}

\subsubsection{数据结构7：Task\_client}
该数据结构定义了任务的基本属性，它将在活动/任务发布与管理功能中应用。
\begin{lstlisting}[language=Java, caption=Task定义]
public class Task{
    private User organizer;//组织者
    private User[] participants;//参与者列表
    private String address;//任务地点
    private Time time;//任务时间
    private String content;//任务内容
    public Task(){

    }
    public User getOrganizer(){

    }
    public User[] getParticipants(){

    }
    public void setParticipants(User[] participants){

    }
    public void addParticipant(User participant){

    }
    public void deleteParticipant(User participant){

    }
    public String getAddress(){

    }
    public void setAddress(String address){

    }
    public Time getTime(){

    }
    public void setTime(Time time){

    }
    public String getContent(){

    }
    public void setContent(){

    }
}
\end{lstlisting}

\subsubsection{数据结构8：Activity\_client}
该数据结构定义了活动项的基本属性，将被用于日历应用。
\begin{lstlisting}[language=Java, caption=Activity定义]
public class Activity{
    private Date date;//活动日期
    private Time time;//活动具体时间
    private String content;//活动内容
    public Activity(Date date, Time time, String content){

    }
    public Date getDate(){

    }
    public void setDate(Date date){

    }
    public Time getTime(){

    }
    public void setTime(){

    }
    public String getContent(){

    }
    public void setContent(String content){
        
    }
}
\end{lstlisting}

\subsubsection{数据结构9：SystemMessage\_client}
该数据结构定义了系统消息，继承自Message类。
\begin{lstlisting}[language=Java, caption=SystemMessage定义]
public class SystemMessage extends Message{
    private int type; //系统消息类型
    public SystemMessage(User sender,User reciver,
        String message,Time sendtime,int type){

    } 
    public int setType(){

    }
}
\end{lstlisting}

\subsubsection{数据结构10：Update\_client}
该数据结构定义了对共享文档的原子更改，所有属性都是不可更改的。
\begin{lstlisting}[language=Java, caption=Update定义]
public class Update{
    private int pos;//修改位置
    private int type;//修改类型（增、删、改）
    private int length;//修改长度
    private String updateText;//修改后的内容
    private String url;//修改的文件的URL
    public Update(int pos,int type,int length,
        String updateText,String url){

    }
    public int getPos(){

    }
    public int getType(){

    }
    public int getLength(){

    }
    public Stirng getUpdateText(){

    }
    public String getURL(){

    }
}
\end{lstlisting}



\subsection{服务器端数据结构}
%--------
\subsubsection{数据结构1：User\_server}
该数据结构定义了用户的基本属性。
\begin{lstlisting}[language=Java, caption=User定义]
public class User{
    private String ID;//用户ID，唯一
    private String name;//昵称，不唯一
    private String sex="Male";//性别，默认男性
    private Date birthday;//用户的出生日期，可以为空
    private Time createTime;//账户创建时间
    private String address;//用户地址，可以为空
    private String email;//用户绑定的邮箱，可以为空
}
\end{lstlisting}

\subsubsection{数据结构2：Message\_server}
该数据结构定义了一对一聊天时发送的信息，所有属性都是不可修改的。此外，在发送文件时，该数据结构也会被使用，用于声明文件的一些基本信息（使用message域）。
\begin{lstlisting}[language=Java, caption=Message定义]
public class Message{
    private User sender,receiver;//该信息的发送方和接收方
    private String message;//信息内容
    private Time sendtime;//发送时间
}
\end{lstlisting}


\subsubsection{数据结构3：AddressBook\_server}
该数据结构定义了通讯录，包括好友列表，群聊列表和黑名单。
\begin{lstlisting}[language=Java, caption=AddressBook定义]
public class AddressBook{
    private Friend[] friendList;//好友列表
    private User[] blackList;//黑名单
    private Group[] groupList;//群聊列表
}
\end{lstlisting}

\subsubsection{数据结构4：Task\_server}
该数据结构定义了任务的基本属性，它将在活动/任务发布与管理功能中应用。
\begin{lstlisting}[language=Java, caption=Task定义]
public class Task{
    private User organizer;//组织者
    private User[] participants;//参与者列表
    private String address;//任务地点
    private Time time;//任务时间
    private String content;//任务内容
}
\end{lstlisting}

\subsubsection{数据结构5：Activity\_server}
该数据结构定义了活动项的基本属性，将被用于日历应用。
\begin{lstlisting}[language=Java, caption=Activity定义]
public class Activity{
    private Date date;//活动日期
    private Time time;//活动具体时间
    private String content;//活动内容
}
\end{lstlisting}

\subsubsection{数据结构6：SystemMessage\_server}
该数据结构定义了系统消息，继承自Message类。
\begin{lstlisting}[language=Java, caption=SystemMessage定义]
public class SystemMessage extends Message{
    private int type; //系统消息类型
}
\end{lstlisting}

\subsubsection{数据结构7：Error\_server}
该数据结构定义了报错的结构体。
\begin{lstlisting}[language=Java, caption=Error定义]
public class SystemMessage extends Message{
    private int position; //出错位置
    private int type; //错误类型
    private Date date; //出错日期
    private Time time; //出错时间
}
\end{lstlisting}


\begin{lstlisting}[language=Java, caption=用户信息管理类]
public class UserInfoManagement{
    private static User[] Users;//存储所有的用户
    private static User[] OnlineUsers; //存储所有的在线用户
    
    public static void registerUser(User_server user){
        //用户注册
    }
    public static int selectUser(User_server user){
        //在Users列表中查询用户对应项
    }
    public static User_server[] recommendUser(User_server
    user){
        //推荐好友列表
    }
    public static AddressBook(
    
 User_server user){
        //查找某个user的联系人列表
    }   pserver(public static void deleteUser(User_server 
    user){
        //删除用户
    }
    public static void UpdateUser(int UserID){
        //更新Users列表中的User信息
        //（例如绑定邮箱后需更新Users列表中对应user的email项）
    }
    public static void upLoad(User_server user){
        //向数据库上传
    }
    public static User[] downLoad(User_server user){
        //从数据库下载用户信息，并打包为User结构体
    }
\end{lstlisting}

\begin{lstlisting}[language=Java, caption=Group定义]
public class Group{
    private String ID;//群ID，唯一
    private String name;//群名称，不唯一
    private User master;//群主
    private User[] managerList;//管理员列表
    private User[] memberList;//群成员列表
    private Scene scene; //场景
}
\end{lstlisting}
%--------

%--------
\begin{lstlisting}[language=Java, caption=通讯管理类]
public class CommunicationManagement{
    private static Message[] messageBuffer; 
    //存储待转发的消息队列
    
    public static Message_server Receive(Message_server
    
    message_received){
        //接收消息
    }
    public static void Send(Message_server message_send){
        //发送消息
    }
    public static void Transfer(User_server sender, 
    User\_server Receiver){
        //转发消息
    )
    public static void upLoad(Message_server message){
        //向数据库上传聊天记录
    }
    public static Message_server downLoad(Message_server 
    message){
        //从数据库下载聊天记录，并打包为Message类
    }
}
\end{lstlisting}
%--------

%--------
\begin{lstlisting}[language=Java, caption=文件管理类]
public class FileManagement{
    private static Message_server[]  FileRecord; 
    //记录所有的文件信息及其存储地址
    
    public static int selectRecord(Message_server record){
        //查询文件记录在FileRecord中的对应项
    }
    
    public static Message_server ReceiveFileRecord(){
        //接收文件记录(其为Message的一种类型，记录了发送者，
        接收者，存储地址等信息)
    }
    public static File ReceiveFile(int FileID){
        //接收文件, 并将其绑定到对应的文件记录
    }
    public static void SendFileRecord(Message_server 
    filerecord){
        //发送文件记录(其为Message的一种类型，记录了发送者，
        接收者，存储地址等信息)
    }
    public static void SendFile(Message_server filerecord,
    File file){
        //发送文件
    }
    public static void Transfer(Message_server filerecord,
    File file){
        //转发文件
    }
    public static void upLoad(Message_server record, 
    File file){
        //向数据库上传文件
    }
    public static File downLoad(Message_server record){
        //根据文件记录中的地址，从数据库下载文件
    }
    
}
\end{lstlisting}
%--------

%--------
\begin{lstlisting}[language=Java, caption=日历管理类]
public class CalendarManagement{
    public static void Activity_server[][] calendarBuffer;
    
    //存储需要修改的日历
    
    public static int[] selectCalendar(Activity_server
    activity){
        //查找日历缓存表中的对应日历项
    }
    public static void addActivity(int[] calendarID, 
    Activity_server activity){
        //向单个或多个日历中添加活动
    }
    public static void deleteActivity(int[] calendarID, 
    Activity_server activity){
        //向单个或多个日历中删除活动
    }
    public static void updateActivity(int [] calendarID, 
    Activity_server activity){
        //向单个或多个日历中更新活动
    }
    public static void upLoad(Activity_server
    [] Calendar){
        //向数据库上传日历
    }
    public static Activity_server[] downLoad(
    Activity_server[] Calendar){
        //从数据库下载日历
    }
    
}
\end{lstlisting}
%--------

%--------
\begin{lstlisting}[language=Java, caption=团队管理类]
public static class GroupManagement{
    public static Group_server[] Groups;
    
    public static int selectGroup(Group_server group){
        //在群组管理列表中寻找对应项
    }
    public static void Assign_Task(Task_server[] task){
        //向组员发布任务
    }
    public static void setAuthority(Group_server group){
        //设置群组中用户的权限
    }
    public static void reflect(SystemMessage_server 
    message){
        //根据组员的反馈信息调整任务
    }
    public static void upLoad(Group_server[] group){
        //向数据库上传团队信息
    }
    public static Group_server[] downLoad(Group_server[] 
    group){
        //从数据库下载团队信息
    }
}
\end{lstlisting}
%--------

%--------
\begin{lstlisting}[language=Java, caption=在线协作类]
public static class CoopeartionManagement{
    public static File[] fileBuffer;//协作文档缓冲池
    
    public static int selectFile(File file){
        //查找文件对应的缓冲池的项
    }
    public static void sendFile(File file){
        //向成员发送最新的文档
    }
    public static File receiveContent(){
        //接收修改的内容
    }
    public static File mergeFile(File file){
        //将对文件的增删改合并到当前文档中
    }
    public static void upLoad(File){
        //向数据库上传协作文档
    }
    public static File downLoad(File){
        //从数据库下载协作文档
    }
    
} 
\end{lstlisting}
%--------
\begin{lstlisting}[language=Java, caption=在线协作类]
public static class ErrorManagement{

    public static Error receiveError(){
        //接收Error
    }
    public static void handleError(){
        //处理能够解决的error
    }
    public static void feedback(Error error){
        //将无法解决的Error反馈给公司
    }

} 
\end{lstlisting}

    %-----------------------------------------------------------------------------
    \section{物理结构设计}
    %-----------------------------------------------------------------------------
        各数据结构无特殊物理结构要求。
    %-----------------------------------------------------------------------------
    \section{数据结构与程序模块的关系}
    %================================ GUIDE ======================================
    % [此处指的是不同的数据结构分配到哪些模块去实现。可按不同的端拆分此表]
    %================================ GUIDE ======================================
        \begin{table}[htbp]
            \centering
            \caption{数据结构与程序代码的关系表} \label{tab:datastructure-module}
            \begin{tabular}{|p{9em}|p{2.5em}|p{2.5em}|p{2.5em}|p{2.5em}|p{2.5em}|
                            p{2.5em}|p{2.5em}|p{2.5em}|}
                \hline %**********************************************************
            ·   & 用户信息管理模块      & 错误信息处理模块  & 云文件管理模块 
                & 文件管理模块          & 日历管理模块      & 团队管理模块      
                & 在线文档协作平台模块  & 通讯管理模块\\
                \hline
                User                & Y   & Y     & · 
                                    & .   & .     & Y
                                    & .   & Y     \\
                \hline
                Message             & .   & Y     & Y 
                                    & Y   & .     & .
                                    & .   & Y     \\
                \hline
                GrouopMessage       & .   & Y     & Y 
                                    & Y   & .     & Y
                                    & .   & Y     \\
                \hline
                Group               & .   & Y     & . 
                                    & .   & .     & Y
                                    & .   & Y     \\
                \hline
                AddressBook         & Y   & Y     & . 
                                    & .   & .     & Y
                                    & .   & Y     \\
                \hline
                Friend              & Y   & Y     & . 
                                    & .   & .     & .
                                    & .   & Y     \\
                \hline
                Task                & .   & Y     & . 
                                    & .   & .     & Y
                                    & .   & .     \\
                \hline
                Activity            & .   & Y     & . 
                                    & .   & Y     & .
                                    & .   & .     \\
                \hline
                Error               & Y   & Y     & Y 
                                    & Y   & Y     & Y
                                    & Y   & Y     \\
                
                \hline
                SystemMessage       & Y   & Y     & Y 
                                    & Y   & Y     & Y
                                    & Y   & Y     \\
                \hline
                UserInfoManagement       & Y   & .     & .
                                    & .   & .     & .
                                    & .   & .     \\
                \hline
                CommunicationManagement       & .   & .     & . 
                                    & .   & .     & .
                                    & .   & Y     \\
                \hline
                CalendarManagement       & .   & .     & .
                                    & .   & Y     & .
                                    & .   & .     \\
                \hline
                GroupManagement       & .   & .     & . 
                                    & .   & .     & Y
                                    & .   & .     \\
                \hline
                CooperationManagement       & .   & .     & . 
                                    & .   & .     & .
                                    & Y   & .     \\
                \hline
                
                
                
            \end{tabular}
            \note{各项数据结构的实现与各个程序模块的分配关系}
        \end{table}
%=================================================================================